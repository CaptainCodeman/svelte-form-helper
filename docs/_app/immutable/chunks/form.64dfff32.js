import{w as A,d as j}from"./index.efb157be.js";const E={dirty:!1,touched:!1,show:!1,message:"",badInput:!1,customError:!1,patternMismatch:!1,rangeOverflow:!1,rangeUnderflow:!1,stepMismatch:!1,tooLong:!1,tooShort:!1,typeMismatch:!1,valid:!1,valueMissing:!1};function L(r,i){const t=k(),{onDirty:o,onTouched:l,validator:v}={onDirty:!1,onTouched:!0,...i},s={id:t,...E},{subscribe:m,set:g}=A(s),a=Object.assign(e=>{r.add(a);let f;async function d(n=!1,c=!1){const O=f=new Object;if(e.checkValidity()&&v){const w=await v(e.value);if(O!==f)return;w&&e.setCustomValidity(w)}s.dirty=s.dirty||c,s.touched=s.touched||n,s.show=!e.validity.valid&&(o&&s.dirty||l&&s.touched),Object.assign(s,{message:e.validationMessage,...M(e.validity)}),g(s),h(e,"data-show",s.show),h(e,"data-dirty",s.dirty),h(e,"data-touched",s.touched),s.show?(e.setAttribute("aria-invalid","true"),e.setAttribute("aria-describedby",t)):(e.removeAttribute("aria-invalid"),e.removeAttribute("aria-describedby"))}function u(n){d(!0,!1)}function b(n){e.setCustomValidity(""),d(!1,!0)}return d(),e.addEventListener("blur",u),e.addEventListener("input",b),{destroy(){r.del(a),e.removeEventListener("blur",u),e.removeEventListener("input",b)}}},{subscribe:m});return a}function M(r){const i={};for(const t in r)i[t]=r[t];return i}let V=0;const k=()=>`form-help:${++V}`,h=(r,i,t)=>{t?r.setAttribute(i,""):r.removeAttribute(i)};function I(){const{subscribe:r,set:i}=A({dirty:!1,touched:!1,valid:!0});let t=[],o;function l(a,e){e&&e();const{subscribe:f}=j(a,d=>{const u=d.every(c=>c.valid),b=d.some(c=>c.dirty),n=d.some(c=>c.touched);return{dirty:b,touched:n,valid:u}});return f(d=>i(d))}const y=Object.assign(a=>(a.noValidate=!0,o=l(t,o),{destroy(){o&&o(),o=void 0}}),{subscribe:r,field:a=>L(y,a),add:a=>{t.includes(a)||(t.push(a),o=l(t,o))},del:a=>{t=t.filter(e=>e!==a),o=l(t,o)}});return y}export{I as c};
