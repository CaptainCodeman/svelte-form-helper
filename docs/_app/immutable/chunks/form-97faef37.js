import{w as h,d as A}from"./index-e56ad522.js";const O={dirty:!1,touched:!1,show:!1,message:"",badInput:!1,customError:!1,patternMismatch:!1,rangeOverflow:!1,rangeUnderflow:!1,stepMismatch:!1,tooLong:!1,tooShort:!1,typeMismatch:!1,valid:!0,valueMissing:!1};function j(i,c){const t=M(),{onDirty:s,validator:d}={onDirty:!0,...c},n={id:t,...O},{subscribe:m,set:y}=h(n),f=Object.assign(e=>{i.add(f);let r;async function u(a=!1,b=!1){const l=r=new Object;if(e.checkValidity()&&d){const g=await d(e.value);if(l!==r)return;g&&e.setCustomValidity(g)}b=n.dirty||b,a=n.touched||a,Object.assign(n,{dirty:b,touched:a,show:a&&!e.validity.valid,message:e.validationMessage,...E(e.validity)}),y(n),n.show?(e.setAttribute("aria-invalid","true"),e.setAttribute("aria-describedby",t)):(e.removeAttribute("aria-invalid"),e.removeAttribute("aria-describedby")),a?e.setAttribute("data-touched",""):e.removeAttribute("data-touched")}function o(a){u(!0,!1)}function v(a){e.setCustomValidity(""),s&&u(!0,!0)}return u(),e.addEventListener("blur",o),e.addEventListener("input",v),{destroy(){i.del(f),e.removeEventListener("blur",o),e.removeEventListener("input",v)}}},{subscribe:m});return f}function E(i){const c={};for(const t in i)c[t]=i[t];return c}let L=0;const M=()=>`form-help:${++L}`;function D(){const{subscribe:i,set:c}=h({dirty:!1,touched:!1,valid:!0});let t=[],s;function d(e,r){r&&r();const{subscribe:u}=A(e,o=>{const v=o.every(l=>l.valid),a=o.some(l=>l.dirty),b=o.some(l=>l.touched);return{dirty:a,touched:b,valid:v}});return u(o=>c(o))}const f=Object.assign(e=>(e.noValidate=!0,s=d(t,s),{destroy(){s&&s(),s=void 0}}),{subscribe:i,field:e=>j(f,e),add:e=>{t.includes(e)||(t.push(e),s=d(t,s))},del:e=>{t=t.filter(r=>r!==e),s=d(t,s)}});return f}export{D as c};
